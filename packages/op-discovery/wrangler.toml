name = "enrai-op-discovery"
main = "dist/index.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Environment variables
[vars]
ISSUER_URL = "http://localhost:8787"
TOKEN_EXPIRY = "3600"
CODE_EXPIRY = "600"
STATE_EXPIRY = "600"
NONCE_EXPIRY = "600"
REFRESH_TOKEN_EXPIRY = "2592000"

# KV Namespaces (only RATE_LIMIT needed for discovery)
[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "rate_limit_namespace_id"
preview_id = "preview_rate_limit_namespace_id"

# Durable Objects
[[durable_objects.bindings]]
name = "KEY_MANAGER"
class_name = "KeyManager"
script_name = "enrai-op-discovery"

[[migrations]]
tag = "v1"
new_classes = ["KeyManager"]

[build]
command = "npm run build"

# Routes (adjust for your domain)
# [[routes]]
# pattern = "yourdomain.com/.well-known/*"
# zone_name = "yourdomain.com"
