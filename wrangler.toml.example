name = "hibana"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Account ID (to be filled in later)
# account_id = ""

# KV Namespaces for state, nonce, and authorization code storage
[[kv_namespaces]]
binding = "AUTH_CODES"
id = "YOUR_AUTH_CODES_ID"
preview_id = "YOUR_AUTH_CODES_PREVIEW_ID"

[[kv_namespaces]]
binding = "STATE_STORE"
id = "YOUR_STATE_STORE_ID"
preview_id = "YOUR_STATE_STORE_PREVIEW_ID"

[[kv_namespaces]]
binding = "NONCE_STORE"
id = "YOUR_NONCE_STORE_ID"
preview_id = "YOUR_NONCE_STORE_PREVIEW_ID"

[[kv_namespaces]]
binding = "CLIENTS"
id = "YOUR_CLIENTS_ID"
preview_id = "YOUR_CLIENTS_PREVIEW_ID"

[[kv_namespaces]]
binding = "REVOKED_TOKENS"
id = "YOUR_REVOKED_TOKENS_ID"
preview_id = "YOUR_REVOKED_TOKENS_PREVIEW_ID"

# Environment variables
[vars]
ISSUER_URL = "http://localhost:8787"
TOKEN_EXPIRY = "3600"
CODE_EXPIRY = "120"
STATE_EXPIRY = "300"
NONCE_EXPIRY = "300"
KEY_ID = "dev-key-TIMESTAMP-XXXXXXX"

# Development environment
[env.development]
name = "hibana-dev"
vars = { ISSUER_URL = "http://localhost:8787" }

# Production environment
[env.production]
name = "hibana-prod"
# vars = { ISSUER_URL = "https://hibana.YOUR_SUBDOMAIN.workers.dev" }

# Build configuration
[build]
command = "npm run build"

# Durable Objects (for key rotation - Phase 4)
# [[durable_objects.bindings]]
# name = "KEY_MANAGER"
# class_name = "KeyManager"
# script_name = "hibana"
